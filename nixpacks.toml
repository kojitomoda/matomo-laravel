[phases.setup]
nixPkgs = ["nodejs_18", "php82", "php82Extensions.pdo_sqlite", "php82Extensions.mbstring", "php82Extensions.dom", "php82Extensions.curl", "php82Extensions.gd", "php82Extensions.zip"]

[phases.install]
dependsOn = ["setup"]
cmds = ["npm ci", "composer install --no-dev --optimize-autoloader"]

[phases.build]
dependsOn = ["install"]
cmds = ["npm run build", "touch /tmp/database.sqlite", "php artisan migrate --force", "php artisan config:cache", "php artisan route:cache", "php artisan view:cache"]

[start]
cmd = "php artisan serve --host=0.0.0.0 --port=${PORT:-8080}"